<div class="dashboard-container" *ngIf="!loading">

  <h2 class="dashboard-title">ğŸ‘‹ Welcome, {{ user?.fullName }}</h2>

  <!-- PROFILE CARD -->
  <div class="card glass fade-in">
    <h3 class="section-title">Your Profile</h3>
    <div class="info-row">
      <span>ğŸ“§ Email</span>
      <strong>{{ user?.email }}</strong>
    </div>
    <div class="info-row">
      <span>ğŸ“± Phone</span>
      <strong>{{ user?.phoneNumber }}</strong>
    </div>
    <div class="info-row">
      <span>ğŸ“ Location</span>
      <strong><strong>{{ user?.city }}, {{ user?.state }}</strong></strong>
    </div>
    <div class="info-row">
      <span>ğŸ—“ Registered</span>
      <strong>{{ user.createdAt | date:'mediumDate' }}</strong>
    </div>
  </div>

  <!-- ORDER CARD -->
  <div class="card glass fade-in" *ngIf="order">
    <h3 class="section-title">Order Details</h3>

    <!-- ORDER PROGRESS BAR -->
<div class="progress-wrapper">
  <div class="progress-title">Order Progress</div>

            <div class="progress-bar">
            <div class="progress-fill" [style.width.%]="orderProgress"></div>
        </div>

        <div class="progress-stages">
            <span [class.active]="order.status === 'created' || order.status === 'paid' || order.status === 'dispatched' || order.status === 'completed'">
            Created
            </span>
            <span [class.active]="order.status === 'paid' || order.status === 'dispatched' || order.status === 'completed'">
            Paid
            </span>
            <span [class.active]="order.status === 'dispatched' || order.status === 'completed'">
            Dispatched
            </span>
            <span [class.active]="order.status === 'completed'">
            Completed
            </span>
        </div>
        </div>


    <div class="info-row">
      <span>ğŸ†” Order ID</span>
      <strong>{{ order._id }}</strong>
    </div>

    <div class="info-row">
      <span>ğŸ“¦ Product</span>
      <strong>{{ order.product?.name }}</strong>
    </div>

    <div class="info-row">
      <span>ğŸ’° Amount Paid</span>
      <strong>â‚¹{{ order.amount }}</strong>
    </div>

    <div class="status-badge" [class.paid]="order.status === 'paid'" 
                              [class.dispatched]="order.status === 'dispatched'"
                              [class.completed]="order.status === 'completed'">
      {{ order.status | uppercase }}
    </div>
  </div>

  <!-- SHIPMENT STATUS -->
  <div class="card glass fade-in" *ngIf="order?.shipment">
    <h3 class="section-title">Shipment Tracking</h3>

    <div class="info-row">
      <span>ğŸšš Courier</span>
      <strong>{{ order.shipment.courierName }}</strong>
    </div>

    <div class="info-row">
      <span>ğŸ« Tracking No</span>
      <strong>{{ order.shipment.trackingNumber }}</strong>
    </div>

    <div class="info-row">
      <span>âš™ Method</span>
      <strong>{{ order.shipment.method }}</strong>
    </div>

    <!-- Shipment Progress -->
    <div class="timeline">
      <div 
        class="timeline-item" 
        *ngFor="let h of order.shipment.history; let i = index"
        [class.active]="i === order.shipment.history.length - 1"
      >
        <div class="dot"></div>
        <div class="timeline-date">{{ h.at | date:'medium' }}</div>
        <div class="timeline-status">{{ h.status }}</div>
        <div class="timeline-message">{{ h.message }}</div>
      </div>
    </div>
  </div>

  <!-- GUIDE DETAILS -->
  <div class="card glass fade-in" *ngIf="order?.assignedGuide">
  <h3 class="section-title">Your Guide</h3>

  <div class="guide-row">
    <div class="avatar">ğŸ‘¨â€ğŸ«</div>
    <div class="guide-info">
      <h4>{{ order.assignedGuide.fullName }}</h4>
      <p>{{ order.assignedGuide.email }}</p>
    </div>
  </div>

  <button class="whatsapp-btn"
          (click)="openWhatsApp(order.assignedGuide.phoneNumber, user?.fullName)">
    ğŸ’¬ Contact on WhatsApp
  </button>
</div>

</div>

<div *ngIf="loading" class="loading-screen">
  <div class="spinner"></div>
  <p>Loading your dashboard...</p>
</div>
